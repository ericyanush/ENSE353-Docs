<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>nat router</title>
    <meta name="description" content="Lab Exercise Documentation" />
    <meta name="author" content="Eric Yanush">
    <meta charset="UTF-8">
    <link rel="icon" href="../templates/default/themes/daux-navy/img/favicon-navy.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='//fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../templates/default/themes/daux-navy/css/daux-navy.css' rel='stylesheet' type='text/css'>
</head>
<body>
            <!-- Docs -->
                <div class="container-fluid fluid-height wrapper">
            <div class="navbar navbar-fixed-top hidden-print">
                <div class="container-fluid">
                    <a class="brand navbar-brand pull-left" href="../index">ENSE 353 Labs</a>
                    <p class="navbar-text pull-right">Generated by <a href="http://daux.io">Daux.io</a></p>
                </div>
            </div>
            <div class="row columns content">
                <div class="left-column article-tree col-sm-3 hidden-print">
                    <!-- For Mobile -->
                    <div class="responsive-collapse">
                        <button type="button" class="btn btn-sidebar" id="menu-spinner-button">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                    </div>
                    <div id="sub-nav-collapse" class="sub-nav-collapse">
                        <!-- Navigation -->
                        <ul class="nav nav-list"><li><a href="../Overview.html">Overview</a></li><li><a href="../Lab_1/index.html" class="folder">Lab 1</a><ul class="nav nav-list"><li><a href="../Lab_1/Box_Building.html">Box Building</a></li><li><a href="../Lab_1/OS_Install.html">OS Install</a></li><li><a href="../Lab_1/Linux_Intro.html">Linux Intro</a></li></ul></li><li><a href="../Lab_2/index.html" class="folder">Lab 2</a><ul class="nav nav-list"><li><a href="../Lab_2/Cable_Making.html">Cable Making</a></li><li><a href="../Lab_2/Connecting_Network.html">Connecting Network</a></li><li><a href="../Lab_2/Remote_SSH_Access.html">Remote SSH Access</a></li></ul></li><li><a href="#" class="aj-nav folder">Assignment 1</a><ul class="nav nav-list"><li><a href="../Assignment_1/Linux_Commands.html">Linux Commands</a></li></ul></li><li><a href="#" class="aj-nav folder">Lab 3</a><ul class="nav nav-list"><li><a href="../Lab_3/Lighting_The_Lamp.html">Lighting The Lamp</a></li></ul></li><li><a href="../Lab_4/index.html" class="folder">Lab 4</a><ul class="nav nav-list"><li><a href="../Lab_4/ntp.html">ntp</a></li><li><a href="../Lab_4/install_phpmyadmin.html">install phpmyadmin</a></li><li><a href="../Lab_4/configure_https.html">configure https</a></li></ul></li><li><a href="../Lab_5/index.html" class="folder">Lab 5</a><ul class="nav nav-list"><li><a href="../Lab_5/dns_server.html">dns server</a></li><li><a href="../Lab_5/email_server.html">email server</a></li></ul></li><li><a href="../Lab_6/index.html" class="folder">Lab 6</a><ul class="nav nav-list"><li><a href="../Lab_6/email_server.html">email server</a></li><li><a href="../Lab_6/webmail_server.html">webmail server</a></li></ul></li><li><a href="../Lab_7/index.html" class="folder">Lab 7</a><ul class="nav nav-list"><li><a href="../Lab_7/gui.html">gui</a></li><li><a href="../Lab_7/vnc_server.html">vnc server</a></li><li><a href="../Lab_7/virtualbox.html">virtualbox</a></li></ul></li><li class="open"><a href="../Lab_8/index.html" class="folder">Lab 8</a><ul class="nav nav-list"><li><a href="../Lab_8/pci_nic.html">pci nic</a></li><li class="active"><a href="../Lab_8/nat_router.html">nat router</a></li></ul></li></ul>                                            </div>
                </div>
                <div class="right-column  content-area col-sm-9">
                    <div class="content-page">
                        <article>
                                                            <div class="page-header sub-header clearfix">
                                    <h1><a href="../Lab_8">Lab 8</a> <i class="glyphicon glyphicon-chevron-right"></i> <a href="../Lab_8/nat_router.html">nat router</a>                                                                            </h1>
                                    <span style="float: left; font-size: 10px; color: gray;">
                                        Wednesday, July 29, 2015                                    </span>
                                    <span style="float: right; font-size: 10px; color: gray;">
                                        6:39 PM                                    </span>
                                </div>
                            
                            <p>The second exercise assigned for the eighth lab was to install and configure services to create a NAT router on our servers.</p>
<h3>Requirements</h3>
<hr />
<p>The requirements to create the NAT router are:</p>
<ol>
<li>Functioning Lab Machine</li>
<li><a href="pci_nic.html">A second network interface.</a></li>
</ol>
<h3>Configuring the Second Network Interface</h3>
<hr />
<p>To configure the second network interface:</p>
<ol>
<li>Launch the Network Manager Text User Interface:
<pre><code>$ nmtui</code></pre></li>
<li>Highlight the edit connection option with the keyboard arrow keys, and select it with the return key:
<img src="../img/Lab_8/nmtui.png" alt="Network Manager TUI" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;"></li>
<li>Highlight your new network interface from the list, and select it with the return key. It may have been renamed "Wired Connection 1".
<img src="../img/Lab_8/nmtui_editconnection.png" alt="Edit Connection Screen" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;"></li>
<li>Highlight the IP4V Configuration option for your connection, and select it using the return key, select Manual from the pop-up list you are presented with:
<img src="../img/Lab_8/connection_ipv4conf.png" alt="IPv4 Connection Config Type" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;"></li>
<li>Select the show option for the IPv4 configuration.</li>
<li>Select the option to "Add" an address to your connection's IPv4 configuration:
<img src="../img/Lab_8/connection_addaddress.png" alt="Add an address to your connection" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;"></li>
<li>Enter a private range IPv4 address, with a /24 subnet, in my case I chose 192.168.3.250/24:
<img src="../img/Lab_8/connection_enteraddress.png" alt="Enter address for your connection" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;"></li>
<li>Select the option for your connection's IPv6 configuration, and set it to ignore:
<img src="../img/Lab_8/connection_ignorev6.png" alt="Disable IPv6 configuration" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;"></li>
<li>Select the <code>OK</code> option from the bottom right corner of the dialog to save your configuration changes, and exit the utility.</li>
</ol>
<p>At this point you will have configured your second network interface to operate your new internal network, however we must configure a few services that will effectively manage the internal network's configuration.</p>
<h3>Configuring Network Administration Services</h3>
<hr />
<p>To configure the administration services for the new internal network:</p>
<ol>
<li>Check the configuration of the firewall's public zone:
<pre><code>$ firewall-cmd --list-all</code></pre>
<p><img src="../img/Lab_8/firewall-public-preconf.png" alt="Current firewall configuration for the public zone" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;">
Here we see that the new network interface we have installed has been automatically added to the firewall's public zone.</p></li>
<li>Change the zone assigned to your second network interface with the command:
<pre><code>$ firewall-cmd --change-interface=&lt;your network interface&gt; --zone=internal</code></pre>
<p>Notice that we did not add the <code>--permanent</code> option to the command; if it is added, the command will silently fail. Reload the firewall configuration with:</p>
<pre><code>$ firewall-cmd --reload</code></pre>
<p>We can now inspect that the interface has been added to the public zone with the command:</p>
<pre><code>$ firewall-cmd --list-all --zone=internal</code></pre>
<p><img src="../img/Lab_8/firewall-changezone.png" alt="Firewall Change Zones for Interface" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;"></p></li>
<li>Next we must enable masquerade on the public zone. This allows traffic from the internal network interface to be routed to the interfaces in the public zone (Network Address Translation Routing). We do this with the command:
<pre><code>$ firewall-cmd --zone=public --add-masquerade --permanent</code></pre>
<p><img src="../img/Lab_8/firewall-addmasquerade.png" alt="Add Masquerade to the public zone" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;"></p></li>
<li>Edit your DNS server configuration, <code>/etc/named.conf</code>, to allow it to listen for requests on your internal interface:
<img src="../img/Lab_8/named_addinterface.png" alt="Allow listening on internal network" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;">
Here I have added the address I configured my internal network interface to use, 192.168.3.250.</li>
<li>Edit your DNS server configuration, <code>/etc/named.conf</code>, to allow the server to perform recursive lookups for clients connecting from the internal interface:
<img src="../img/Lab_8/named_allowrecursioninternal.png" alt="Allow recursion on local network" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;">
Here I have whitelisted recursion for clients that have addresses within the subnet that the address I configured my internal interface is within, 192.168.3.0/24</li>
<li>Restart your DNS server to force it to reload its configuration:
<pre><code>$ systemctl restart named</code></pre></li>
<li>Allow DNS queries through the firewall in the internal zone, and reload the firewall configuration:
<pre><code>$ firewall-cmd --add-port=53/udp --zone=internal --permanent
$ firewall-cmd --reload</code></pre></li>
<li>Install a DHCP server:
<pre><code>$ yum install dhcp</code></pre></li>
<li>Change into the DHCP server's configuration directory:
<pre><code>$ cd /etc/dhcp</code></pre></li>
<li>Download the preconfigured DHCP server configuration:
<pre><code>$ curl -O http://cgelowitz.gelowitz.org/dhcpd.conf</code></pre>
<p><img src="../img/Lab_8/fetch_dhcpconfig.png" alt="Download DHCP server configuration" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;"></p></li>
<li>Edit the configuration file you just downloaded. In my case, because I used an address in the 192.168.3.0/24 Subnet, I have only three changes that are necessary, as the configuration file is already setup for a server running a network on that subnet.
<img src="../img/Lab_8/dhcpconf_hostdns.png" alt="Change the hostname and DNS server adddresses" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;">
Here I have changed the hostname of the network to match the hostname that has been assigned to my machine, and I have changed the DNS server address that will be provided to clients connecting to my internal network to the address I have configured for my second (internal) network interface. The changes I have made are circled in red.
<img src="../img/Lab_8/dhcpconf_defaultgw.png" alt="Change the default gateway" class="img-responsive"  style="margin-bottom:20px;height:350px;margin-right:auto;margin-left:auto;">
The last change I have to make to this configuration is to the address of the default gateway that is provided to clients connecting to my internal network; here again I have changed the configured address to be the address I configured for my machine's internal network interface. The change is outlined in red.</li>
</ol>
<p>At this point, any single client should be able to connect directly to your machine's internal network interface via a cross-over ethernet cable, or indirectly through a switch. When it does, it will be assigned an IP address by your DHCP server, and will be given enough information (Default Gateway, DNS Server address) that it will be able to connect to the internet by routing traffic through your machine's primary (public) network interface.</p>                                                    </article>
                    </div>
                </div>
            </div>
        </div>
    
        

    <!-- jQuery -->
            <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined')
                document.write(unescape("%3Cscript src='../js/jquery-1.11.0.min.js' type='text/javascript'%3E%3C/script%3E"));
        </script>
    
    <!-- hightlight.js -->
    <script src="../js/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <!-- Front end file editor -->
        <script src="../js/custom.js"></script>
    <!--[if lt IE 9]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

</body>
</html>

